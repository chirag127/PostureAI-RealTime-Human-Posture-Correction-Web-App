# CI Workflow for PostureGuard-AI-Posture-Correction-Desktop-App

name: CI

# Controls when the workflow will run
# Runs on pushes to the main branch and pull requests targeting the main branch

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [18.x, 20.x]

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Fetch all history so that --all is available to git-cli

      - name: Setup Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node-version }}
          cache: 'npm' # Cache npm dependencies

      - name: Install Dependencies
        run: npm ci # Use npm ci for faster, deterministic installs

      - name: Setup Biome Linter and Formatter
        # Biome needs to be installed globally for commands like 'biome check'
        run: npm install -g @biomejs/biome

      - name: Lint and Format Check with Biome
        run: biome check --apply --diagnostic-level=warn
        # --apply automatically fixes formatting issues and some linting errors.
        # Use '--apply-unsafe' for more aggressive auto-fixing if needed, but 'check' is safer for CI.

      - name: Build Project with Vite
        run: npm run build
        env:
          NODE_ENV: production
          # CI=true sets Vite to production mode, disabling HMR etc.
          CI: true

      - name: Run Vitest (Unit/Integration Tests)
        run: npm run test:unit

      - name: Upload Coverage Reports
        uses: codecov/codecov-action@v4
        with:
          token: ${{ secrets.CODECOV_TOKEN }} # Make sure to set this secret in your GitHub repository settings
          files: ./coverage/coverage.json # Path to your coverage report, adjust if necessary
          fail_ci_if_error: true

      # Example for E2E tests with Playwright (if applicable)
      # - name: Install Playwright Browsers
      #   run: npx playwright install
      #
      # - name: Run Playwright End-to-End Tests
      #   run: npm run test:e2e
      #   env:
      #     CI: true

      # Tauri specific build step might be added here if needed for specific platforms
      # For example, building a macOS or Windows executable.
      # Depending on the build complexity, a separate job or more complex steps might be required.
